<!html>
<head>
  <title>The Keymaster</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script src="keymaster.patch.js"></script>
  <script src="keymaster.js"></script>
<style>
#messages {
  width: 100%;
  height: 200px;
}
kbd {
  background-color: #ccc;
  border: 2px solid #888;
  border-right: 2px solid #aaa;
  border-bottom: 2px solid #aaa;
  border-radius: 3px;
  padding: 0 3px;
}
</style>
<script>
function updateScope(scope) {
  var e = document.getElementById('scope');
  e.innerHTML = scope;
}

function msg(message) {
  var e = document.getElementById('messages');
  e.value += message + '\n';
}

function init() {
  var _oldSetScope = key.setScope;
  key.setScope = function (scope) {
    _oldSetScope(scope);
    updateScope(scope);
  }
}
</script>
</head>
<body onload="init()">
  <h1>
    The FKeymaster Demonstration
  </h1>

  <div>Current Scope: <span id="scope">all</span></div>
  <div>
    <div>Messages: (Press 'c' in it with 'all' scope to clear messages)</div>
    <textarea id="messages"></textarea>
  </div>

  <script>
    key('c', { match: '#messages' }, function(){
      var e = document.getElementById('messages');
      e.value = '';
      return false;
    });
  </script>

  <div>
    <input type="text" placeholder="a text input"/>
    <select><option></option><option>select</option></select>
  </div>
  <div>
    <textarea placeholder="a textarea"></textarea>
    <textarea placeholder="My ID is TextArea" id="TextArea"></textarea>
  </div>

  <p>Text in [SCOPE] indicates the key is activated in SCOPE. [ANY] means any scopes.</p>
  <ol>
    <li><kbd>o</kbd> or <kbd>Enter</kbd> or <kbd>&larr;</kbd> [ANY]</li>
    <li><kbd>i</kbd>:
      <ul>
        <li>Switches scope to 'issues'. [ANY]</li>
        <li>match: <code>#TextArea</code>. [issues] or [all]</li>
      </ul>
    <li><kbd>a</kbd>: Switches scope to 'all'. [ANY]</li>
    <li><kbd>b</kbd>: Switches scope to 'Blah Blah Blah'. [ANY]</li>
    <li><kbd>c</kbd> [issues]</li>
    <li><kbd>t</kbd>: match: <code>textarea</code>. [ANY]</li>
    <li><kbd>⌘</kbd>+<kbd>&rarr;</kbd>, <kbd>Shift</kbd>+<kbd>&larr;</kbd> or <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Alt</kbd>+<kbd>d</kbd>. [ANY]</li>
    <li><kbd>s</kbd>→<kbd>i</kbd> [issues]</li>
    <li><kbd>g</kbd>→<kbd>s</kbd> [ANY]</li>
    <li><kbd>g</kbd>→<kbd>s</kbd>→<kbd>f</kbd> [ANY]</li>
    <li><kbd>Ctrl</kbd>+<kbd>g</kbd> or <kbd>Alt</kbd>+<kbd>g</kbd>→<kbd>s</kbd> [ANY]</li>
  </ol>

  <p>
    When a input, a select or a textarea element above is focused, key inputs should be ignored if it's [ANY].
  </p>

  <script>
    key('/', function(){
      msg('/ pressed!');
      return false;
    });

    key('c', 'issues', function(){
     msg('c/issues');
    });

    key('command+r, ctrl+r', 'issues', function(){
      msg('Hijacked Command+R or Ctrl+R, damn!');
      return false;
    });
   
    key('i', { match: "#TextArea", scope: "all" }, function(){
      msg('You pressed i in TextArea with "all" scope');
    });

    key('i', { match: "#TextArea", scope: "issues" }, function(){
      msg('You pressed i in TextArea with "issues" scope');
    });

    key('t', { match: "textarea" }, function(){
      msg('You pressed t in <textarea/> and I ate you "t." Nomnomnom.');
      return false;
    });

    key('o, enter, left', function(){
      msg('o, enter or left pressed!');
    });

    key('ctrl+c', function(){
      msg('this is not the command line');
    });

    key('⌘+right,shift+left,ctrl+shift+alt+d', function(event){
      msg('command+right, or shift+left, or ctrl+shift+alt+d is pressed, check your console log.');
      console.log('here is the event: ', event);
      console.log('key.control', key.control);
      console.log('key.ctrl', key.ctrl);
      console.log('key.shift', key.shift);
      console.log('key.alt', key.alt);
      console.log('key["⌘"]', key["⌘"]);
      return false; // prevent default && stop propagation
    });

    key('⌘+x, ctrl+x', function(event, handler){
      msg('key: ' + handler.key + ', scope: ' + handler.scope);
      return false;
    });

    key(["s", "i"], 'issues', function () {
      msg("show -> issues");
    });

    key(["g", "s"], function () {
      msg("go -> settings");
    });

    key(["g", "s", "f"], function () {
      msg("go -> settings -> fonts");
    })

    key(["ctrl+g,alt+g", "s"], function () {
      msg("gogo -> settings");
    })

    key('b', function(){
      key.setScope('Blah Blah Blah');
      msg('Switched to "Blah Blah Blah" scope.');
    });

    key('i', function(){
      key.setScope('issues');
      msg('Switched to "issues" scope. Command+R or Ctrl+R is now no longer reloading...');
    });

    key('a', function(){
      key.setScope('all');
      msg('Switched to "all" scope.');
    });
  </script>
</body>
</html>
